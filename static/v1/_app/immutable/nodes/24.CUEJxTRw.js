import"../chunks/disclose-version.BDr9Qe-U.js";import"../chunks/legacy.CNpbjrm0.js";import{a6 as w,p as $a,ad as o,ae as O,af as wa,a4 as G,a as ja,$ as _a,g as e,j as a,a5 as n,a7 as g,a9 as d,ag as L,a8 as re,aa as ya,ah as Oe}from"../chunks/index-client.wsxBsMrC.js";import{s as z,e as Se}from"../chunks/render.CGk_31K2.js";import{i as j}from"../chunks/if.CdP3FEr9.js";import{e as ba}from"../chunks/OptionSelect.ZTdPq3oL.js";import{a as i,n as ka,t as f,b as se,c as De}from"../chunks/template.CyQ6qVeq.js";import{h as xa}from"../chunks/svelte-head.2q0gYbHo.js";import{s as B,B as ce,t as Ma,b as za}from"../chunks/Button.BsAE8GCO.js";import{i as Ca}from"../chunks/lifecycle.BqqCO0-d.js";import{I as La,J as Ta,K as Ia,o as Ua,M as Pa,T as qa,n as He,N as Ba,O as Na,_ as Ra,P as Va,Q as Aa,S as Fa,U as Je,d as Ge,V as Ka}from"../chunks/dataFetching.BTF7Y2Cd.js";import{I as Wa,c as Ea,a as Oa,y as Sa}from"../chunks/Input.CbYO_vsg.js";import{W as Da}from"../chunks/WebauthnRequest.CJdyVez7.js";import{P as Ha}from"../chunks/PasswordInput.CYtyiDqV.js";import{L as Ja}from"../chunks/LangSelector.Q_ihhFqZ.js";import{p as xe}from"../chunks/props.byAfpN0R.js";import{M as Ga,C as Xa}from"../chunks/ContentCenter.24rd6EYh.js";import{u as Ya}from"../chunks/i18n.svelte.B_PCuqyN.js";import{T as X}from"../chunks/Template.D8ipGA-s.js";import{u as N}from"../chunks/param.svelte.cJM6dcHK.js";var Za=ka('<svg fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"></path></svg>');function Qa(ne,Y){let c=xe(Y,"color",3,"var(--col-text)"),y=xe(Y,"opacity",3,.9),S=xe(Y,"width",3,24);var h=Za();B(h,"stroke-width",2),w(()=>{B(h,"width",S()),B(h,"color",c()),B(h,"opacity",y())}),i(ne,h)}var et=f('<img alt="No Logo Available">'),at=f('<a class="home svelte-1ljcjf3"><!></a>'),tt=f('<div role="button" tabindex="0" class="forgotten svelte-1ljcjf3"> </div>'),rt=f("<!> <!>",1),st=f('<div class="btn flex-col svelte-1ljcjf3"><!></div>'),lt=f('<div class="btn flex-col svelte-1ljcjf3"><!></div>'),it=f("<!> <!> <!>",1),ot=f('<div class="flex-inline svelte-1ljcjf3"><img alt="" width="20" height="20"> <span class="providerName svelte-1ljcjf3"> </span></div>'),ct=f('<div class="providers flex-col svelte-1ljcjf3"></div>'),nt=f('<div class="errMsg errMsgApi svelte-1ljcjf3"> </div>'),vt=f('<div class="success svelte-1ljcjf3"> </div>'),dt=f('<a class="reg svelte-1ljcjf3" target="_blank"> </a>'),ut=f('<a class="reg svelte-1ljcjf3" href="/auth/v1/users/register" target="_blank"> </a>'),mt=f('<div class="btn flex-col svelte-1ljcjf3"><!></div>'),gt=f('<div class="container svelte-1ljcjf3"><div class="head svelte-1ljcjf3"><div class="logo svelte-1ljcjf3"><!></div> <!></div> <div class="name svelte-1ljcjf3"><h2> </h2></div> <!> <!> <!> <!> <!> <!> <!></div> <!>',1),ft=f("<!> <!> <!> <!> <!> <!> <!>",1);function ht(ne,Y){var Ne;$a(Y,!1);let c=Ya(),y=N("client_id").get(),S=o(""),h=o(""),D=N("redirect_uri").get(),ve=N("nonce").get(),de=((Ne=N("scopes").get())==null?void 0:Ne.split(" "))||[],Z=o(),ue=N("state").get(),me=N("code_challenge").get(),ge=N("code_challenge_method").get(),fe=o(!1),H=o(),le=o([]),Q=o(),R=o(!1),b=o(""),V=o(""),ee=o(""),A=o(!1),F=o(!1),ie=o(!1),oe=o(!1),ae=o(!1),K=o(!1),Me="",he=o(!1),l=o({email:N("login_hint").get()||"",password:""}),k=o({}),pe=o({});function ze(){a(b,""),a(ie,!0),L(l,e(l).password="")}async function $e(){a(b,"");try{await e(pe).validate(e(l),{abortEarly:!1}),a(k,{})}catch(_){a(k,He(_));return}const t={email:e(l).email,client_id:y,redirect_uri:D,state:ue,code_challenge:me,code_challenge_method:ge,nonce:ve,scopes:de};if(e(A)&&e(l).email!==e(H)){if(!e(l).password){L(k,e(k).password=c.passwordRequired);return}if(e(l).password.length>256){L(k,e(k).password="max 256");return}t.password=e(l).password}a(R,!0);let p=await Ba(t);await Ce(p)}async function Ce(t){if(t.status===202)window.location.replace(t.headers.get("location"));else if(t.status===200)a(b,""),a(Q,await t.json());else if(t.status===406)a(b,c.authorize.clientForceMfa),a(F,!0);else if(t.status===429){let p=Number.parseInt(t.headers.get("x-retry-not-before")),_=Na(p),T=p*1e3-new Date().getTime();a(K,!0),a(b,`${c.authorize.http429} ${_}`),L(l,e(l).email=""),L(l,e(l).password=""),a(A,!1),setTimeout(()=>{a(K,!1),a(b,"")},T)}else e(A)?(a(b,c.authorize.invalidCredentials),a(oe,!0)):(a(A,!0),Me=e(l).email);a(R,!1)}function Xe(){e(A)&&Me!==e(l).email&&(a(A,!1),L(l,e(l).password=""),a(b,""))}function Ye(t){Ra(64,(p,{challenge:_,verifier:T})=>{p||(localStorage.setItem(Va,T),Ze(t,_))})}async function Ze(t,p){let _={email:e(l).email||null,client_id:y,redirect_uri:D,scopes:de,state:ue,nonce:ve,code_challenge:me,code_challenge_method:ge,provider_id:t,pkce_challenge:p},T=await Aa(_);if(T.ok){const J=await T.text();Fa(J),window.location.href=T.headers.get("location")}else{let J=await T.json();a(b,J.message)}}function Qe(){a(Q,void 0)}function ea(t){t&&window.location.replace(t.loc)}async function aa(){try{await e(pe).validate(e(l),{abortEarly:!1}),a(k,{})}catch(_){a(k,He(_));return}let t={email:e(l).email};e(h)&&(t.redirect_uri=encodeURI(e(h))),a(R,!0);let p=await Ka(t);if(p.ok)a(ae,!0);else{let _=await p.json();a(b,_.message)}a(R,!1)}O(()=>Sa,()=>{c&&a(pe,Ea().shape({email:Oa().required(c.authorize.emailRequired).email(c.authorize.emailBadFormat)}))}),O(()=>e(V),()=>{var t;e(V)&&(e(V)==="Refresh"?a(fe,!0):(t=e(V))!=null&&t.startsWith("MfaLogin ")&&a(H,e(V).replace("MfaLogin ","")))}),O(()=>(e(fe),Je),()=>{if(e(fe)&&(y==null?void 0:y.length)>0&&(D==null?void 0:D.length)>0){a(R,!0);const t={client_id:y,redirect_uri:D,state:ue,code_challenge:me,code_challenge_method:ge,nonce:ve,scopes:de};ya().then(()=>Je(t).then(p=>Ce(p)))}}),O(()=>e(H),()=>{e(H)&&L(l,e(l).email=e(H))}),O(()=>e(ae),()=>{e(ae)&&setTimeout(()=>{a(ae,!1),a(ie,!1),a(oe,!1)},3e3)}),O(()=>e(Z),()=>{e(Z)&&e(Z).focus()}),O(()=>(e(ee),Ge),()=>{e(ee)&&Ge(e(ee))}),wa(),Ca();var Le=ft();xa(t=>{w(()=>_a.title=`Login ${(e(S)||y)??""}`)});var Te=G(Le);X(Te,{id:La,get value(){return e(le)},set value(t){a(le,t)},$$legacy:!0});var Ie=n(Te,2);X(Ie,{id:Ta,get value(){return e(S)},set value(t){a(S,t)},$$legacy:!0});var Ue=n(Ie,2);X(Ue,{id:Ia,get value(){return e(h)},set value(t){a(h,t)},$$legacy:!0});var Pe=n(Ue,2);X(Pe,{id:Ua,get value(){return e(ee)},set value(t){a(ee,t)},$$legacy:!0});var qe=n(Pe,2);X(qe,{id:Pa,get value(){return e(V)},set value(t){a(V,t)},$$legacy:!0});var Be=n(qe,2);X(Be,{id:qa,get value(){return e(he)},set value(t){a(he,t)},$$legacy:!0});var ta=n(Be,2);Ga(ta,{children:(t,p)=>{Xa(t,{children:(_,T)=>{var J=gt(),we=G(J),je=g(we),_e=g(je),ra=g(_e);{var sa=r=>{var s=et();B(s,"src",`/auth/v1/clients/${y}/logo`),i(r,s)};j(ra,r=>{y&&r(sa)})}d(_e);var la=n(_e,2);{var ia=r=>{var s=at(),u=g(s);Qa(u,{opacity:.5}),d(s),w(()=>B(s,"href",e(h))),i(r,s)};j(la,r=>{e(h)&&r(ia)})}d(je);var ye=n(je,2),Re=g(ye),oa=g(Re,!0);d(Re),d(ye);var Ve=n(ye,2);{var ca=r=>{Da(r,{t:c,onSuccess:ea,onError:Qe,get data(){return e(Q)},set data(s){a(Q,s)},$$legacy:!0})};j(Ve,r=>{e(Q)&&r(ca)})}var Ae=n(Ve,2);{var na=r=>{var s=it(),u=G(s),I=Oe(()=>e(K)||e(F));Wa(u,{type:"email",name:"rauthyEmail",autocomplete:"email",get placeholder(){return c.common.email},get disabled(){return e(I)},get value(){return e(l).email},set value(m){L(l,e(l).email=m)},get error(){return e(k).email},set error(m){L(k,e(k).email=m)},$$events:{enter:$e,input:Xe},children:(m,P)=>{re();var E=se();w(()=>z(E,c.common.email.toUpperCase())),i(m,E)},$$slots:{default:!0},$$legacy:!0});var W=n(u,2);{var x=m=>{var P=rt(),E=G(P),be=Oe(()=>e(K)||e(F));Ha(E,{name:"rauthyPassword",get error(){return e(k).password},autocomplete:"current-password",get placeholder(){return c.common.password},get disabled(){return e(be)},get bindThis(){return e(Z)},set bindThis(v){a(Z,v)},get value(){return e(l).password},set value(v){L(l,e(l).password=v)},$$events:{enter:$e},children:(v,M)=>{re();var C=se();w(()=>z(C,c.common.password.toUpperCase())),i(v,C)},$$slots:{default:!0},$$legacy:!0});var ke=n(E,2);{var q=v=>{var M=tt(),C=g(M,!0);d(M),w(()=>z(C,c.authorize.passwordForgotten)),Ma(7,M,()=>za),Se("click",M,ze),Se("keypress",M,ze),i(v,M)};j(ke,v=>{e(oe)&&!e(K)&&v(q)})}i(m,P)};j(W,m=>{e(A)&&e(H)!==e(l).email&&!e(ie)&&m(x)})}var $=n(W,2);{var U=m=>{var P=De(),E=G(P);{var be=q=>{var v=st(),M=g(v);ce(M,{$$events:{click:aa},children:(C,pa)=>{re();var te=se();w(()=>z(te,c.authorize.passwordRequest)),i(C,te)},$$slots:{default:!0}}),d(v),i(q,v)},ke=q=>{var v=lt(),M=g(v);ce(M,{get isLoading(){return e(R)},set isLoading(C){a(R,C)},$$events:{click:$e},children:(C,pa)=>{re();var te=se();w(()=>z(te,c.authorize.login)),i(C,te)},$$slots:{default:!0},$$legacy:!0}),d(v),i(q,v)};j(E,q=>{e(ie)?q(be):q(ke,!1)})}i(m,P)};j($,m=>{!e(K)&&!e(F)&&m(U)})}i(r,s)};j(Ae,r=>{e(F)||r(na)})}var Fe=n(Ae,2);{var va=r=>{var s=ct();ba(s,5,()=>e(le),u=>u.id,(u,I)=>{ce(u,{level:3,$$events:{click:()=>Ye(e(I).id)},children:(W,x)=>{var $=ot(),U=g($),m=n(U,2),P=g(m,!0);d(m),d($),w(()=>{B(U,"src",`/auth/v1/providers/${e(I).id}/img`),z(P,e(I).name)}),i(W,$)},$$slots:{default:!0}})}),d(s),i(r,s)};j(Fe,r=>{e(le)&&r(va)})}var Ke=n(Fe,2);{var da=r=>{var s=nt(),u=g(s,!0);d(s),w(()=>z(u,e(b))),i(r,s)};j(Ke,r=>{e(b)&&r(da)})}var We=n(Ke,2);{var ua=r=>{var s=vt(),u=g(s,!0);d(s),w(()=>z(u,c.authorize.emailSentMsg)),i(r,s)};j(We,r=>{e(ae)&&r(ua)})}var Ee=n(We,2);{var ma=r=>{var s=De(),u=G(s);{var I=x=>{var $=dt(),U=g($,!0);d($),w(()=>{B($,"href",`/auth/v1/users/register?redirect_uri=${e(h)??""}`),z(U,c.authorize.signUp)}),i(x,$)},W=x=>{var $=ut(),U=g($,!0);d($),w(()=>z(U,c.authorize.signUp)),i(x,$)};j(u,x=>{e(h)?x(I):x(W,!1)})}i(r,s)};j(Ee,r=>{e(he)&&!e(F)&&!e(oe)&&!e(K)&&r(ma)})}var ga=n(Ee,2);{var fa=r=>{var s=mt(),u=g(s);ce(u,{$$events:{click:()=>window.location.href="/auth/v1/account"},children:(I,W)=>{re();var x=se("ACCOUNT");i(I,x)},$$slots:{default:!0}}),d(s),i(r,s)};j(ga,r=>{e(F)&&r(fa)})}d(we);var ha=n(we,2);Ja(ha,{absolute:!0}),w(()=>z(oa,e(S)||y)),i(_,J)},$$slots:{default:!0}})},$$slots:{default:!0}}),i(ne,Le),ja()}export{ht as component};
