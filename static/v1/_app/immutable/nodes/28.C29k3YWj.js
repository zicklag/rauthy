import"../chunks/disclose-version.BDr9Qe-U.js";import{p as se,a3 as h,a4 as U,a as me,a6 as v,$ as oe,g as t,j as i,a5 as o,aa as le,a7 as y,a9 as k,a8 as _}from"../chunks/index-client.wsxBsMrC.js";import{s as l}from"../chunks/render.CGk_31K2.js";import{i as B}from"../chunks/if.CdP3FEr9.js";import{a as n,t as x,b,c as ne}from"../chunks/template.CyQ6qVeq.js";import{h as ce}from"../chunks/svelte-head.2q0gYbHo.js";import{p as c}from"../chunks/proxy.MUfQDWlv.js";import{r as ve}from"../chunks/legacy-client.Dm1n63jC.js";import{I as A,c as ue,a as F}from"../chunks/Input.CbYO_vsg.js";import{r as de,n as ge,t as fe,u as pe,v as $e}from"../chunks/dataFetching.BTF7Y2Cd.js";import{B as Ne}from"../chunks/Button.BsAE8GCO.js";import{L as he}from"../chunks/LangSelector.Q_ihhFqZ.js";import{f as ye}from"../chunks/pow.dgjdRmCA.js";import{M as ke,C as we}from"../chunks/ContentCenter.24rd6EYh.js";import{u as xe}from"../chunks/i18n.svelte.B_PCuqyN.js";import{T as Ce}from"../chunks/Template.D8ipGA-s.js";import{u as Ee}from"../chunks/param.svelte.cJM6dcHK.js";var Ue=x(" <br> <code> </code>",1),_e=x('<div class="success svelte-1ks9oi1"> <br> </div>'),be=x('<div class="err svelte-1ks9oi1"> </div>'),qe=x('<div class="container svelte-1ks9oi1"><div class="domainTxt svelte-1ks9oi1"><h1> </h1> <!></div> <!> <!> <!> <!> <!></div> <!>',1),Le=x("<!> <!>",1);function Ie(S,V){se(V,!0);let a=xe(),p=h(""),P=Ee("redirect_uri"),C=h(!1),g=h(""),q=h(!1),m=c({email:"",givenName:"",familyName:""}),u=h(c({})),Q=h(c({}));ve(()=>{a&&i(Q,c(ue().shape({email:F().required(a.common.required).email(a.register.emailBadFormat),givenName:F().required(a.common.required).matches(pe,a.register.regexName),familyName:F().matches($e,a.register.regexName)})))});function L(d){d.detail.code==="Enter"&&W()}async function W(){i(q,!1),i(g,"");try{await t(Q).validate(m,{abortEarly:!1}),i(u,c({}))}catch(f){i(u,c(ge(f)));return}if(t(p)&&!m.email.endsWith(t(p))){i(g,c(a.register.domainErr));return}i(C,!0),await le();let d=await ye();const I={email:m.email,given_name:m.givenName,family_name:m.familyName.length>0?m.familyName:void 0,pow:d};let E=P.get();E&&(I.redirect_uri=E);const M=await fe(I);if(M.ok)i(g,""),i(q,!0),setTimeout(()=>{window.location.replace(P.get()||"/auth/v1/account")},3e3);else{const f=await M.json();f.message.includes("UNIQUE constraint")?i(g,"E-Mail is already registered"):i(g,c(f.message))}i(C,!1)}var D=Le();ce(d=>{v(()=>oe.title=(a==null?void 0:a.register)||"Register")});var G=U(D);Ce(G,{id:de,get value(){return t(p)},set value(d){i(p,c(d))}});var X=o(G,2);ke(X,{children:(d,I)=>{we(d,{children:(E,M)=>{var f=qe(),R=U(f),T=y(R),j=y(T),Y=y(j,!0);k(j);var z=o(j,2);{var Z=e=>{var s=Ue(),r=U(s,!0),$=o(r,2),N=o($),w=y(N);k(N),v(()=>{l(r,a.register.domainRestricted),l($,` ${a.register.domainAllowed??""} `),l(w,`@${t(p)??""}`)}),n(e,s)};B(z,e=>{t(p)&&e(Z)})}k(T);var H=o(T,2);A(H,{type:"email",autocomplete:"email",get placeholder(){return a.common.email},get value(){return m.email},set value(e){m.email=e},get error(){return t(u).email},set error(e){t(u).email=e},$$events:{keypress:L},children:(e,s)=>{_();var r=b();v(()=>l(r,a.common.email.toUpperCase())),n(e,r)},$$slots:{default:!0}});var J=o(H,2);A(J,{autocomplete:"given-name",get placeholder(){return a.account.givenName},get value(){return m.givenName},set value(e){m.givenName=e},get error(){return t(u).givenName},set error(e){t(u).givenName=e},$$events:{keypress:L},children:(e,s)=>{_();var r=b();v(()=>l(r,a.account.givenName.toUpperCase())),n(e,r)},$$slots:{default:!0}});var K=o(J,2);A(K,{autocomplete:"family-name",get placeholder(){return a.account.familyName},get value(){return m.familyName},set value(e){m.familyName=e},get error(){return t(u).familyName},set error(e){t(u).familyName=e},$$events:{keypress:L},children:(e,s)=>{_();var r=b();v(()=>l(r,a.account.familyName.toUpperCase())),n(e,r)},$$slots:{default:!0}});var O=o(K,2);Ne(O,{get isLoading(){return t(C)},set isLoading(e){i(C,c(e))},$$events:{click:W},children:(e,s)=>{_();var r=b();v(()=>l(r,a.register.register)),n(e,r)},$$slots:{default:!0}});var ee=o(O,2);{var ae=e=>{var s=_e(),r=y(s,!0),$=o(r,2);k(s),v(()=>{l(r,a.register.success),l($,` ${a.register.emailCheck??""}`)}),n(e,s)},re=e=>{var s=ne(),r=U(s);{var $=N=>{var w=be(),ie=y(w,!0);k(w),v(()=>l(ie,t(g))),n(N,w)};B(r,N=>{t(g)&&N($)},!0)}n(e,s)};B(ee,e=>{t(q)?e(ae):e(re,!1)})}k(R);var te=o(R,2);he(te,{absolute:!0}),v(()=>l(Y,a.register.userReg)),n(E,f)},$$slots:{default:!0}})},$$slots:{default:!0}}),n(S,D),me()}export{Ie as component};
