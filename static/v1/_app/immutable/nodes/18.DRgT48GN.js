import"../chunks/disclose-version.BDr9Qe-U.js";import{j as e,a7 as v,g as t,a5 as u,a9 as o,a6 as m,a3 as f,p as De,o as Me,a4 as W,a as Oe,$ as Se,a8 as ee}from"../chunks/index-client.wsxBsMrC.js";import{e as B,s as p}from"../chunks/render.CGk_31K2.js";import{i as z}from"../chunks/if.CdP3FEr9.js";import{e as We,i as Be}from"../chunks/OptionSelect.ZTdPq3oL.js";import{a as s,t as x,b as ae,c as he}from"../chunks/template.CyQ6qVeq.js";import{h as Ee}from"../chunks/svelte-head.2q0gYbHo.js";import{p as c}from"../chunks/proxy.MUfQDWlv.js";import{r as Ge}from"../chunks/legacy-client.Dm1n63jC.js";import{a0 as He,a1 as we,a2 as Je,l as Ue,a3 as Xe,n as Ye}from"../chunks/dataFetching.BTF7Y2Cd.js";import{t as q,s as Ze,b as ce,f as Ce,B as le}from"../chunks/Button.BsAE8GCO.js";import{t as ne}from"../chunks/helpers.DikdX20z.js";import{p as ue}from"../chunks/props.byAfpN0R.js";import{L as qe}from"../chunks/LangSelector.Q_ihhFqZ.js";import{c as Ie,a as Ke,I as Ne}from"../chunks/Input.CbYO_vsg.js";import{f as Qe}from"../chunks/pow.dgjdRmCA.js";import{M as Re,C as Ve}from"../chunks/ContentCenter.24rd6EYh.js";import{u as Fe}from"../chunks/i18n.svelte.B_PCuqyN.js";import{T as ea}from"../chunks/Template.D8ipGA-s.js";import{u as aa}from"../chunks/param.svelte.cJM6dcHK.js";var ta=x('<div class="circle svelte-10pff2x"></div>'),sa=x('<div class="circle svelte-10pff2x"></div>'),ra=x('<div class="circle svelte-10pff2x"></div>'),oa=x('<div class="container svelte-10pff2x"><div class="inner svelte-10pff2x"><!> <!> <!></div></div>');function ia(te,E){let I=ue(E,"offset",3,0),a=ue(E,"background",3,!0),G=ue(E,"local",3,!1),y=f(!0),$=f(!1),l=f(!1);setTimeout(()=>{e($,!0)},300),setTimeout(()=>{e(l,!0)},600);var g=oa(),b=v(g),H=v(b);{var K=i=>{var r=ta();B("introend",r,()=>e(y,!1)),B("outroend",r,()=>e(y,!0)),q(7,r,()=>ce,()=>({delay:600,duration:1e3})),s(i,r)};z(H,i=>{t(y)&&i(K)})}var L=u(H,2);{var D=i=>{var r=sa();B("introend",r,()=>e($,!1)),B("outroend",r,()=>e($,!0)),q(7,r,()=>ce,()=>({delay:600,duration:1e3})),s(i,r)};z(L,i=>{t($)&&i(D)})}var N=u(L,2);{var se=i=>{var r=ra();B("introend",r,()=>e(l,!1)),B("outroend",r,()=>e(l,!0)),q(7,r,()=>ce,()=>({delay:600,duration:1e3})),s(i,r)};z(N,i=>{t(l)&&i(se)})}o(b),o(g),m(()=>{ne(g,"global",!G()),ne(g,"local",G()),ne(g,"background",a()),Ze(b,"style",`margin-top: ${`${I()}px`??""}`)}),q(3,b,()=>Ce,()=>({duration:100})),q(7,g,()=>Ce,()=>({duration:100})),s(te,g)}var da=x('<div class="desc svelte-19xxeot"> </div> <!> <!>',1),va=x('<div class="desc svelte-19xxeot"><p> </p> <p> </p></div>'),ca=x('<div class="desc svelte-19xxeot"><p class="declined svelte-19xxeot"> </p> <p> </p></div>'),la=x("<li> </li>"),na=x('<div class="desc svelte-19xxeot"> <ul></ul></div> <div class="inline svelte-19xxeot"><!> <!></div>',1),ua=x('<div class="container svelte-19xxeot"><div class="name svelte-19xxeot"><h2> </h2></div> <!> <div class="err svelte-19xxeot"> </div></div>'),pa=x("<!> <!>",1),ma=x("<!> <!>",1);function fa(te,E){De(E,!0);const I="8rem";let a=Fe(),G=f(void 0),y=f(""),$=f(8),l=f(!1),g=!1,b=f(void 0),H=f(!1),K=f(!1),L=c({userCode:""}),D=f(c({userCode:""})),N=f(c({}));Ge(()=>{a&&t($)&&e(N,c(Ie().shape({userCode:Ke().trim().min(t($),a.common.errTooShort).max(t($),a.common.errTooLong).matches(Ue,a.common.invalidInput)})))}),Me(async()=>{let n=aa("code").get();n&&(L.userCode=n);let J=await He();J.ok?e(G,c(await J.json())):n?we(`device?code=${n}`):we("device")});function se(){g&&r()}async function i(n){var U;if(e(y,""),g=!0,!await r())return;e(l,!0);let J=await Qe(),re={user_code:L.userCode,pow:J,device_accepted:n};const j=await Xe(re);if(j.status===200){const A=await j.json();console.log(A),e(b,c(((U=A.scopes)==null?void 0:U.split(" "))||["openid"]))}else if(j.status===202)e(H,!0),setTimeout(()=>{window.location.replace("/auth/v1/account?v=devices")},2e3);else if(j.status===204)e(K,!0);else if(j.status===404)e(y,c(a.device.wrongOrExpired));else{const A=await j.json();e(y,c(A.message))}e(l,!1)}async function r(){try{return await t(N).validate(L,{abortEarly:!1}),e(D,c({userCode:""})),!0}catch(n){return e(D,c(Ye(n))),!1}}var pe=ma();Ee(n=>{m(()=>Se.title=(a==null?void 0:a.device.title)||"Device Authorization")});var me=W(pe);ea(me,{id:Je,get value(){return t($)},set value(n){e($,c(n))}});var ye=u(me,2);Re(ye,{children:(n,J)=>{Ve(n,{children:(re,j)=>{var U=pa(),A=W(U);{var be=M=>{ia(M,{})},Le=M=>{var oe=ua(),ie=v(oe),fe=v(ie),Te=v(fe,!0);o(fe),o(ie);var xe=u(ie,2);{var je=O=>{var X=da(),Y=W(X),de=v(Y,!0);m(()=>p(de,a.device.desc.replace("{{count}}",t($)))),o(Y);var Q=u(Y,2);Ne(Q,{name:"userCode",autocomplete:"off",get placeholder(){return a.device.userCode},get value(){return L.userCode},set value(d){L.userCode=d},get error(){return t(D).userCode},set error(d){t(D).userCode=d},$$events:{enter:i,input:se},children:(d,P)=>{ee();var h=ae();m(()=>p(h,a.device.userCode.toUpperCase())),s(d,h)},$$slots:{default:!0}});var k=u(Q,2);le(k,{get isLoading(){return t(l)},set isLoading(d){e(l,c(d))},$$events:{click:()=>i("pending")},children:(d,P)=>{ee();var h=ae();m(()=>p(h,a.device.submit)),s(d,h)},$$slots:{default:!0}}),s(O,X)},Ae=O=>{var X=he(),Y=W(X);{var de=k=>{var d=va(),P=v(d),h=v(P,!0);o(P);var R=u(P,2),T=v(R,!0);o(R),o(d),m(()=>{p(h,a.device.isAccepted),p(T,a.device.autoRedirectAccount)}),s(k,d)},Q=k=>{var d=he(),P=W(d);{var h=T=>{var S=ca(),_=v(S),V=v(_,!0);o(_);var Z=u(_,2),F=v(Z,!0);o(Z),o(S),m(()=>{p(V,a.device.isDeclined),p(F,a.device.closeWindow)}),s(T,S)},R=T=>{var S=na(),_=W(S),V=v(_),Z=u(V);We(Z,21,()=>t(b),Be,(w,ve)=>{var C=la(),ze=v(C,!0);o(C),m(()=>p(ze,t(ve))),s(w,C)}),o(Z),o(_);var F=u(_,2),ge=v(F);le(ge,{level:1,width:I,get isLoading(){return t(l)},set isLoading(w){e(l,c(w))},$$events:{click:()=>i("accept")},children:(w,ve)=>{ee();var C=ae();m(()=>p(C,a.device.accept)),s(w,C)},$$slots:{default:!0}});var _e=u(ge,2);le(_e,{level:3,width:I,get isLoading(){return t(l)},set isLoading(w){e(l,c(w))},$$events:{click:()=>i("decline")},children:(w,ve)=>{ee();var C=ae();m(()=>p(C,a.device.decline)),s(w,C)},$$slots:{default:!0}}),o(F),m(()=>p(V,`${a.device.descScopes??""} `)),s(T,S)};z(P,T=>{t(K)?T(h):T(R,!1)},!0)}s(k,d)};z(Y,k=>{t(H)?k(de):k(Q,!1)},!0)}s(O,X)};z(xe,O=>{t(b)===void 0?O(je):O(Ae,!1)})}var $e=u(xe,2),Pe=v($e,!0);o($e),o(oe),m(()=>{p(Te,a.device.title),p(Pe,t(y))}),s(M,oe)};z(A,M=>{t(G)?M(Le,!1):M(be)})}var ke=u(A,2);qe(ke,{absolute:!0}),s(re,U)},$$slots:{default:!0}})},$$slots:{default:!0}}),s(te,pe),Oe()}export{fa as component};
